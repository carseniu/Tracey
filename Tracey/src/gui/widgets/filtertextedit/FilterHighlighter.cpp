#include "FilterHighlighter.h"

#include "src/gui/widgets/filtertextedit/FilterTextEdit.h"

#include <QDebug>
#include <QTextDocument>


//===================================================================================================================================================================================================//
// PUBLIC
//===================================================================================================================================================================================================//

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
FilterHighlighter::FilterHighlighter(FilterTextEdit* filterTextEdit) :
  QSyntaxHighlighter(filterTextEdit->document()),
  filterTextEdit(filterTextEdit),
  font(QFont("Arial", 9)),
  errorPosition(-1)
{
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
FilterHighlighter::~FilterHighlighter()
{
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void FilterHighlighter::highlightBlock(const QString &text)
{
  QFont operatorFont = font;
  operatorFont.setBold(true);
    
  QTextCharFormat operatorFormat;
  operatorFormat.setForeground(QColor("#ff0000"));
  operatorFormat.setBackground(QColor("#ffff00"));
  operatorFormat.setFont(operatorFont);

  for (const int operatorPosition : filterTextEdit->getOperatorPositions())
  {
    setFormat(operatorPosition, 1, operatorFormat);
  }


  // Show the error
  if (errorPosition != -1)
  {
    QTextCharFormat errorFormat;
    errorFormat.setForeground(QColor("#ffff00"));
    errorFormat.setBackground(QColor("#ff0000"));
    errorFormat.setFont(font);

    setFormat(errorPosition, 1, errorFormat);
  }
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void FilterHighlighter::highlightError(int position)
{
  errorPosition = position;
  rehighlight();
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void FilterHighlighter::setFont(const QFont& font)
{
  this->font = font;
  rehighlight();
}