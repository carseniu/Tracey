#include "CommandDelete.h"

#include "FilterTextEdit.h"

#include <QDebug>


//===================================================================================================================================================================================================//
// PUBLIC
//===================================================================================================================================================================================================//

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
CommandDelete::CommandDelete(FilterTextEdit* filterTextEdit) :
  filterTextEdit(filterTextEdit)
{
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void CommandDelete::execute()
{
  QTextCursor tc = filterTextEdit->textCursor();
  position = tc.position();
  selectionStart = tc.selectionStart();
  selectionEnd = tc.selectionEnd();
  start = tc.position();
  deleteSize = 1;

  if (!tc.selectedText().isEmpty())
  {
    start = selectionStart;
    deleteSize = selectionEnd - selectionStart;
  }

  deletedText = filterTextEdit->toPlainText().mid(start, deleteSize);
  deletedOperatorPositions = filterTextEdit->getOperatorPositions(start, deleteSize);

  filterTextEdit->deleteText(start, deleteSize);

  filterTextEdit->setFocus();
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void CommandDelete::redo()
{
  filterTextEdit->deleteText(start, deleteSize);

  filterTextEdit->setFocus();
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void CommandDelete::undo()
{
  filterTextEdit->insertText(deletedText, deletedOperatorPositions, start);

  filterTextEdit->setSelectionAndCursorPosition(position, selectionStart, selectionEnd);

  filterTextEdit->setFocus();
}