#include "src/gui/core/HistoryModel.h"

#include "src/gui/core/Configuration.h"

#include <QDebug>


//===================================================================================================================================================================================================//
// PUBLIC
//===================================================================================================================================================================================================//

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
HistoryModel::HistoryModel(const Type& type, QObject* parent) :
  QStringListModel(parent),
  type(type)
{
  setStringList(Config().getHistory(type));

  connect(this, &HistoryModel::dataChanged, this, &HistoryModel::processDataChanged);
  connect(this, &HistoryModel::modelReset, this, &HistoryModel::processModelReset);
}


//===================================================================================================================================================================================================//
// PRIVATE SLOTS
//===================================================================================================================================================================================================//

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void HistoryModel::processDataChanged(const QModelIndex &topLeft, const QModelIndex &bottomRight, const QVector<int> &roles)
{
  Config().deleteHistory(type);
  Config().saveHistory(type, stringList());
}

//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
void HistoryModel::processModelReset()
{
  Config().deleteHistory(type);
}